<form id="cadastroForm" method='POST' enctype='multipart/form-data'>
	<input name='marca' placeholder='Marca' required>
	<input name='modelo' placeholder='Modelo' required>
	<input name='ano' placeholder='Ano' required>
	<input name='categoria' placeholder='Categoria'>
	<input name='preco' placeholder='Preço' required>
	<input name='id_vendedor' placeholder='ID do Vendedor'>
	<input type='file' name='imagem'>
	<button type='submit'>Cadastrar</button>
</form>
<div id="mensagem" style="margin-top:8px;color:green"></div>

<script>
document.getElementById('cadastroForm').addEventListener('submit', async function(e) {
	e.preventDefault(); // evita navegação para /veiculos

	const form = e.target;
	const data = new FormData(form);

	try {
		const res = await fetch('http://localhost:3000/veiculos', {
			method: 'POST',
			body: data
		});

		if (!res.ok) {
			const err = await res.json().catch(() => ({}));
			document.getElementById('mensagem').style.color = 'red';
			document.getElementById('mensagem').textContent = err.error || 'Erro ao cadastrar';
			return;
		}

		const json = await res.json().catch(() => null);
		document.getElementById('mensagem').style.color = 'green';
		document.getElementById('mensagem').textContent = (json && (json.msg || json)) || 'Veículo cadastrado com sucesso! Redirecionando...';
		form.reset();
		// Redireciona para a lista para que o novo veículo apareça
		setTimeout(() => { window.location.href = 'listar.html'; }, 1000);
	} catch (error) {
		document.getElementById('mensagem').style.color = 'red';
		document.getElementById('mensagem').textContent = 'Erro de conexão';
	}
});
</script>